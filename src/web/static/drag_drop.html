<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        .multi-drop-zone {
            border: 2px dashed #cccccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background-color: #f8f9fa;
            margin: 10px 0;
            transition: all 0.3s ease;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .multi-drop-zone:hover {
            border-color: #667eea;
            background-color: #f0f4ff;
            transform: translateY(-2px);
        }
        
        .multi-drop-zone.drag-over {
            border-color: #4caf50;
            background-color: #e8f5e8;
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }
        
        .drop-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .drag-over .drop-icon {
            color: #4caf50;
            transform: scale(1.2);
        }
        
        .drop-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .drop-hint {
            font-size: 14px;
            color: #999;
            margin-top: 10px;
        }
        
        .file-list {
            margin-top: 20px;
            text-align: left;
            width: 100%;
        }
        
        .file-item {
            background: #f1f3f4;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .file-item:hover {
            background: #e8eaf6;
            transform: translateX(5px);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-name {
            font-weight: 500;
            color: #333;
        }
        
        .file-size {
            color: #666;
            font-size: 12px;
        }
        
        .remove-btn {
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s ease;
        }
        
        .remove-btn:hover {
            background: #d84315;
        }
        
        .clear-all-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s ease;
        }
        
        .clear-all-btn:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }
        
        .file-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="multiDropZone" class="multi-drop-zone">
        <div class="drop-icon">ğŸ“</div>
        <div class="drop-text">æ‹–æ‹½å¤šä¸ªæ–‡ä»¶åˆ°è¿™é‡Œ</div>
        <div class="drop-hint">æ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰¹é‡å¤„ç†</div>
        <div id="fileList" class="file-list" style="display: none;"></div>
        <div id="fileCount" class="file-count" style="display: none;"></div>
        <button id="clearAllBtn" class="clear-all-btn" style="display: none;">æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
    </div>

    <script>
        let selectedFiles = [];
        
        const dropZone = document.getElementById('multiDropZone');
        const fileList = document.getElementById('fileList');
        const fileCount = document.getElementById('fileCount');
        const clearAllBtn = document.getElementById('clearAllBtn');
        
        // é˜»æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });
        
        // é«˜äº®æ‹–æ‹½åŒºåŸŸ
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });
        
        // å¤„ç†æ–‡ä»¶æ‹–æ‹½
        dropZone.addEventListener('drop', handleDrop, false);
        
        // ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
        dropZone.addEventListener('click', function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = function(e) {
                handleFiles(e.target.files);
            };
            input.click();
        });
        
        // æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶
        clearAllBtn.addEventListener('click', function() {
            selectedFiles = [];
            updateFileList();
            updateStreamlit();
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight() {
            dropZone.classList.add('drag-over');
        }
        
        function unhighlight() {
            dropZone.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        function handleFiles(files) {
            [...files].forEach(file => {
                // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
                const exists = selectedFiles.some(f => f.name === file.name && f.size === file.size);
                if (!exists) {
                    selectedFiles.push({
                        name: file.name,
                        size: file.size,
                        lastModified: file.lastModified,
                        type: file.type || 'unknown',
                        id: Date.now() + Math.random()
                    });
                }
            });
            
            updateFileList();
            updateStreamlit();
        }
        
        function removeFile(fileId) {
            selectedFiles = selectedFiles.filter(f => f.id !== fileId);
            updateFileList();
            updateStreamlit();
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function updateFileList() {
            if (selectedFiles.length === 0) {
                fileList.style.display = 'none';
                fileCount.style.display = 'none';
                clearAllBtn.style.display = 'none';
                dropZone.querySelector('.drop-text').textContent = 'æ‹–æ‹½å¤šä¸ªæ–‡ä»¶åˆ°è¿™é‡Œ';
                dropZone.querySelector('.drop-hint').textContent = 'æ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰¹é‡å¤„ç†';
                return;
            }
            
            fileList.style.display = 'block';
            fileCount.style.display = 'block';
            clearAllBtn.style.display = 'block';
            
            fileCount.textContent = `å·²é€‰æ‹© ${selectedFiles.length} ä¸ªæ–‡ä»¶`;
            
            fileList.innerHTML = selectedFiles.map(file => `
                <div class="file-item">
                    <div class="file-info">
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">(${formatFileSize(file.size)})</span>
                    </div>
                    <button class="remove-btn" onclick="removeFile(${file.id})">ç§»é™¤</button>
                </div>
            `).join('');
            
            dropZone.querySelector('.drop-text').textContent = 'ç»§ç»­æ·»åŠ æ›´å¤šæ–‡ä»¶';
            dropZone.querySelector('.drop-hint').textContent = 'æˆ–ç‚¹å‡»ç§»é™¤ä¸éœ€è¦çš„æ–‡ä»¶';
        }
        
        function updateStreamlit() {
            // å‘é€æ–‡ä»¶ä¿¡æ¯åˆ°Streamlit
            window.parent.postMessage({
                type: 'multi_file_drop',
                files: selectedFiles
            }, '*');
        }
    </script>
</body>
</html>
